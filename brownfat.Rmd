---
title: "brownfat"
output: pdf_document....0

---

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(pheatmap)
library(car)
library(gridExtra)
library(tidyr)
```

Read the file:

```{r}
# the excel sheet represents NA values by "NA"
brownfat <- read_excel("./description/BrownFat.xls", na = "NA")
nrow(brownfat)
```

Check if there's any NA values:

```{r}
x <- colSums(is.na(brownfat)) # 
x[x > 0]
```

3 variables has NA values detected: Cancer_Status, Cancer_Type, and TSH. Data cleaning needed.

Notice that $4425$ out of $n=4842$ observations had no data on their `TSH`, as this ratio is too large in order for us to confidently assign the most-probable values, we will choose to exclude the variable `TSH` altogether.

```{r}
brownfat_cleaned_data <- brownfat %>% select(-c("TSH", "Id"))
```

There are observations where both the `Cancer_Status` and `Cancer_Type` is set to NA, as we don't have domain knowledge to assign appropriate values nor is it the main focus of this research, we will simply exclude these observations.

```{r}
# determine how many obs. display such behaviour
x <- sum(is.na(brownfat$Cancer_Status) & is.na(brownfat$Cancer_Type))
paste("No. of observations w/ Cancer_Status == Cancer_Type == NA is:", x)

# exclude these obs.
brownfat_cleaned_data <- brownfat_cleaned_data %>% 
  filter(!(is.na(Cancer_Status) & is.na(Cancer_Type)))
```

Observe that since the remaining $369  - 250 = 119$ observations still having `Cancer_Type == NA` also have that `Cancer_Status == 0`, meaning they do have cancer (thus setting `Cancer_Type` to $0$ is not a valid option) and hence we can either assign values to these missing values or once again, simply remove them.

-   Option 1: We calculate the estimate probability of each category (other than $0$) based on their frequency in the given data, and then assign `NA` values using our new probability measure.

```{r}
set.seed("14")

# calculate the estimated prob. of each category (except 0, and NAs)
cancer_status_category_prob <- brownfat_cleaned_data %>%
  filter(!is.na(Cancer_Type) & Cancer_Type != 0) %>%
  count(Cancer_Type) %>% 
  mutate(probability = n / sum(n))

# function to re-assign those w/ NA values
assign_cancer_type <- function(x) {
  if (is.na(x)) {
    sample(cancer_status_category_prob$Cancer_Type, 1, 
           prob = cancer_status_category_prob$probability)
  } else {
    x
  }
}


# re-assign those w/ Cancer_Type == NA
brownfat_cleaned_data_v1 <- brownfat_cleaned_data
brownfat_cleaned_data_v1$Cancer_Type <- sapply(brownfat_cleaned_data$Cancer_Type,
                                   assign_cancer_type)
```

Why may this method be problematic? =\> We've only taking into the account the frequencies of each of these types of cancer when in reality, a multitude of other factors affect the diagnosis of single patient. (We may consider to improve this later on by also creating a prediction model)

-   Option 2: To avoid potential hazardous assumptions, we may opt to exclude these `NA` values altogether:

```{r}
brownfat_cleaned_data_v2 <- brownfat_cleaned_data %>%
  filter(!is.na(Cancer_Type))
```

Lets check for the distribution of the age:
```{r}
brownfat_cleaned_data_v2 <- brownfat_cleaned_data %>%
    filter(!is.na(Cancer_Type))
```

Lets check for the distribution of the age:
```{r}
g1 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Sex)) +
    geom_bar(fill = "grey")+
    ggtitle("Bar Plot of Sex")

g2 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Diabetes)) +
    geom_bar(fill = "grey")+
    ggtitle("Bar Plot of Diabetes")

g3 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Age))+
    geom_histogram()

g4 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Day))+
    geom_histogram()
##brownfat_cleaned_data_v2$Month <- factor(brownfat_cleaned_data_v2$Month, levels = 1:12)
g5 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Month))+
    geom_bar()
g6 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Ext_Temp))+
    geom_histogram()
g7 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = `2D_Temp`))+
    geom_histogram()
g8 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = `3D_Temp`))+
    geom_histogram()
g9 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = `7D_Temp`))+
    geom_histogram()
g10 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = `1M_Temp`))+
    geom_histogram()
g11 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Duration_Sunshine))+
    geom_histogram()
g12 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Weigth))+
    geom_histogram()
g13 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Size))+
    geom_histogram()
g14 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = BMI))+
    geom_histogram()
g15 <-ggplot(data = brownfat_cleaned_data_v2, aes(x = Glycemy))+
    geom_histogram()
g16 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = LBW))+
    geom_histogram()
g17 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Cancer_Status)) +
    geom_bar(fill = "grey")+
    ggtitle("Bar Plot of Cancer Status")
g18 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Cancer_Type)) +
    geom_bar(fill = "grey")+
    ggtitle("Bar Plot of Cancer Type")
g19 <- ggplot(data = brownfat_cleaned_data_v2, aes(x = Total_vol))+
    geom_histogram()

# Separate response variable into 2 cases:
no_brownfat <- subset(brownfat_cleaned_data_v2, Total_vol == 0)
has_brownfat <- subset(brownfat_cleaned_data_v2, Total_vol > 0)

# Plot with no brown fat: 
g20 <- ggplot(no_brownfat, aes(x = Total_vol)) +
  geom_histogram(binwidth = 10, color = "black", fill = "red") +
  ggtitle("Individuals with No Brown Fat")

# Plot with some brown fat:
g21 <- ggplot(has_brownfat, aes(x = Total_vol)) +
  geom_histogram(binwidth = 10, color = "black", fill = "blue") +
  ggtitle("Individuals with Brown Fat")

grid.arrange(g1, g2, g5, g17, g18, ncol = 3, nrow = 2)

grid.arrange(g3, g4, g6, g7, g8, g9, g10, g11, g12, ncol = 3, nrow = 3)

grid.arrange(g13, g14, g15, g16, g19, g20, g21, ncol = 3, nrow = 3)

```

```{r}
mean_age <- mean(brownfat_cleaned_data_v2$Age)
mean_age
mean_ext_temp <- mean(brownfat_cleaned_data_v2$Ext_Temp)
mean_ext_temp
mean_weight <- mean(brownfat_cleaned_data_v2$Weigth)
mean_weight
mean_height <- mean(brownfat_cleaned_data_v2$Size)
mean_height
mean_BMI <- mean(brownfat_cleaned_data_v2$BMI)
mean_BMI
mean_LBW <- mean(brownfat_cleaned_data_v2$LBW)
mean_LBW

```
- The explanatory variable Age seems to follow approximately close to a normal distribution with a mean of 61.82. The sample looks skewed toward the elderly side of the adults.

- The majority of people tested did not have diabetes.

- The day/month people were tested were scattered around the year, not particularly focused on any day or interval.

- The explanatory variable Ext_Temp seems to follow approximately but far from a normal distribution, with a mean of 6.

- The weight of the people tested approximately follow a normal distribution with mean of 73.27kg.

- The height of the people tested approximately follow a normal distribution with mean of 165.6cm.

- The BMI of the people tested approximately follow a normal distribution with mean of 26.66.

- The majority of the people tested has glycemia level in the interval of (5-10).

- The LBW of the people tested approximately follow a normal distribution with mean of 51.53.
The correlation matrix of the model is given by: 

- The amount of tester with cancer is moderately higher than those without.

- The most popular type of cancer is lung, digestive and non-Hodgkin lymphoma.
```{r}
brownfat_cleaned_data_v2$Month <- as.numeric(factor(brownfat_cleaned_data_v2$Month))
cor_matrix <- cor(brownfat_cleaned_data_v2)
pheatmap(cor_matrix, display_numbers = TRUE, cluster_rows = FALSE, cluster_cols = FALSE)
```
We notice that:
- All the temperature covariates are strongly, positively correlated to each other. 
- Weight is highly correlated with BMI and LBW.
- Sex, Size and LBW are strongly, positively  correlated to each other.
- The season is negatively, moderately correlated to the temperature and sunshine duration covariates.
- The sunshine is positively, strongly correlated to the temperature covariates.
- Cancer status and cancer type are positively, moderately correlated to each other.

Lets try centering the model:
(Note: We tried centering, it just didn't work)

Lets try finding the relationship between the temperature covariates and the total volumes:
```{r}
# graph relationship between external temperature and total volume
ggplot(brownfat_cleaned_data_v2, aes(Ext_Temp, Total_vol)) +
  geom_point(color = "black", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "red")

# graph relationship between 2D_temp and total volume
ggplot(brownfat_cleaned_data_v2, aes(`2D_Temp`, Total_vol)) +
  geom_point(color = "brown", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "pink")

# graph relationship between 3D_temp and total volume
ggplot(brownfat_cleaned_data_v2, aes(`3D_Temp`, Total_vol)) +
  geom_point(color = "darkblue", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "green")

# graph relationship between 7D_temp and total volume
ggplot(brownfat_cleaned_data_v2, aes(`7D_Temp`, Total_vol)) +
  geom_point(color = "violet", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "orange")

# graph relationship between 3D_temp and total volume
ggplot(brownfat_cleaned_data_v2, aes(`1M_Temp`, Total_vol)) +
  geom_point(color = "blue", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "yellow")

# overlap them:
brownfat_long <- brownfat_cleaned_data_v2 %>%
  pivot_longer(cols = c(Ext_Temp, `2D_Temp`, `3D_Temp`, `7D_Temp`,  `1M_Temp`),
               names_to = "Temperature_Type",
               values_to = "Temperature_Value")

# Create overlapping plot
ggplot(brownfat_long, aes(x = Temperature_Value, y = Total_vol, color = Temperature_Type)) +
  geom_point(alpha = 0.6, size = 2) +  # Scatter points with transparency
  geom_smooth(method = "lm", se = FALSE) +  # Linear trend lines
  theme_minimal() +
  labs(title = "Temperature vs Total Volume",
       x = "Temperature Value",
       y = "Total Volume",
       color = "Temperature Type") +  # Legend title
  theme(legend.position = "right")  # Move legend to the right

```

```{r}
#Graph sex vs total volume:
ggplot(brownfat_cleaned_data_v2, aes(x = factor(Sex), y = Total_vol)) + 
  geom_boxplot() +
  labs(title = "sex vs total volume: box plot")
```

Comment: female tester generally has higher brown fat volume than male.

```{r}
#Graphing Age vs Total_volume
ggplot(brownfat_cleaned_data_v2, aes(Age, Total_vol)) +
  geom_point(color = "black", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "red")
```

```{r}
#graph the relationship between Weight, LBW, BMI to total volume.

brownfat_long <- brownfat_cleaned_data_v2 %>%
  pivot_longer(cols = c(Weigth, BMI, LBW ),
               names_to = "Weight_types",
               values_to = "Values")

# Create overlapping plot
ggplot(brownfat_long, aes(x = Values, y = Total_vol, color = Weight_types)) +
  geom_point(alpha = 0.6, size = 2) +  # Scatter points with transparency
  geom_smooth(method = "lm", se = FALSE) +  # Linear trend lines
  theme_minimal() +
  labs(title = "Weight, BMI and LBW",
       x = "Weights",
       y = "Total Volume",
       color = "Weight Type") +  # Legend title
  theme(legend.position = "right")  # Move legend to the right
```

Graph the relationship between Weight, BMI and LBW to the total volume:
```{r}
ggplot(brownfat_cleaned_data_v2, aes(x = factor(Diabetes), y = Total_vol)) + 
  geom_boxplot() +
  labs(title = "Diabetes vs total volume: box plot")
```

Comment: Those without diabetes have more brown fat than those with diabetes.

Graph the relationship between Weight, BMI and LBW to the total volume:

```{r}
# Relationship between Glycemia and total volume.

ggplot(brownfat_cleaned_data_v2, aes(Glycemy, Total_vol)) +
  geom_point(color = "black", size = 2) +
  geom_smooth(method = "lm", se = FALSE, colour = "red")
```

Graph of relationship of cancer status vs total volume:

```{r}
ggplot(brownfat_cleaned_data_v2, aes(x = factor(Cancer_Status), y = Total_vol)) + 
  geom_boxplot() + 
  labs(title = "Diabetes vs total volume: box plot")
```

Graph of relationship of cancer status vs total volume:

```{r}
ggplot(brownfat_cleaned_data_v2, aes(x = factor(Cancer_Type), y = Total_vol)) + 
  geom_boxplot() + 
  labs(title = "Diabetes vs total volume: box plot")
```


